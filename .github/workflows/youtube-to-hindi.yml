name: YouTube → Hindi Text

on:
  workflow_dispatch:
    inputs:
      youtube_url:
        description: 'YouTube video URL'
        required: true
        default: 'https://www.youtube.com/watch?v=8SRe1bNO38E'

jobs:
  transcribe:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y nodejs
        pip install -q yt-dlp openai-whisper torch transformers sentencepiece sacremoses

    - name: Create cookies file from secret
      run: |
        echo "${{ secrets.YOUTUBE_COOKIES }}" > cookies.txt
        echo "✅ Cookies file created."

    - name: Run transcription + translation
      env:
        YOUTUBE_URL: ${{ github.event.inputs.youtube_url }}
        COOKIES_FILE: cookies.txt
      run: python scripts/transcribe_translate.py

    - name: Upload Hindi text as artifact
      uses: actions/upload-artifact@v4
      with:
        name: hindi_text
        path: hindi_output.txt
